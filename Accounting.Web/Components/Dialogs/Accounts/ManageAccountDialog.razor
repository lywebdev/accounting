@using System.ComponentModel.DataAnnotations
@using Accounting.Core.Enums
@using MudBlazor
@inject IStringLocalizer<SharedResources> Localizer

<MudDialog>
    <DialogContent>
        <MudAlert Severity="Severity.Info" Dense="true" Variant="Variant.Text" Class="mb-3">
            @Localizer["Coa_Dialog_Note"]
        </MudAlert>
        <MudForm @ref="_form">
            <MudTextField @bind-Value="Model.Number"
                          Label="@Localizer["Coa_Field_Number"]"
                          Disabled="DisableNumber"
                          Required="true"
                          MaxLength="20"
                          Immediate="true" />
            <MudTextField @bind-Value="Model.Name"
                          Label="@Localizer["Coa_Field_Name"]"
                          Required="true"
                          MaxLength="128"
                          Class="mt-4" />
            <MudSelect T="AccountCategory" Label="@Localizer["Coa_Field_Category"]" @bind-Value="Model.Category" Class="mt-4">
                @foreach (var category in Enum.GetValues<AccountCategory>())
                {
                    <MudSelectItem Value="category">@Localizer[$"Account_Category_{category}"]</MudSelectItem>
                }
            </MudSelect>
            <MudTextField @bind-Value="Model.Description"
                          Label="@Localizer["Coa_Field_Description"]"
                          Lines="3"
                          MaxLength="256"
                          Class="mt-4" />
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text" Color="Color.Default" OnClick="Cancel">@Localizer["Coa_Dialog_Cancel"]</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="SaveAsync">@Localizer["Coa_Dialog_Save"]</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance DialogInstance { get; set; } = default!;

    [Parameter]
    public AccountEditModel Model { get; set; } = new();

    [Parameter]
    public bool DisableNumber { get; set; }

    private MudForm _form = default!;

    private async Task SaveAsync()
    {
        await _form.Validate();
        if (!_form.IsValid)
        {
            return;
        }

        DialogInstance.Close(DialogResult.Ok(Model));
    }

    private void Cancel() => DialogInstance.Cancel();

    public class AccountEditModel
    {
        [Required]
        [StringLength(20)]
        public string Number { get; set; } = string.Empty;

        [Required]
        [StringLength(128)]
        public string Name { get; set; } = string.Empty;

        public AccountCategory Category { get; set; } = AccountCategory.Assets;

        [StringLength(256)]
        public string? Description { get; set; }
    }
}
